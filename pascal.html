<!doctype html>
<html class="no-js" lang="fr-FR">
<head>
    <meta charset="utf-8" />
    <title>Temps restant avant mon départ</title>
    <script>
        var TheFinalCountDown = (function () {
            var translates = {
                weeks: 'semaine(s)',
                days: 'jour(s)',
                hours: "heure(s)",
                minutes: "minute(s)",
                seconds: "seconde(s)"
            };

            var factors = {
                weeks: (7 * 24 * 60 * 60 * 1000),
                days: (24 * 60 * 60 * 1000),
                hours: (60 * 60 * 1000),
                minutes: (60 * 1000),
                seconds: 1000
            };

            var getDateTime = function (item) {
                if (typeof item === 'string')
                    return Date.parse(item);
                if (typeof item === 'number')
                    return item;
                else if (typeof item === 'object' && item instanceof Date)
                    return item.getTime();
                return new Date(0);
            };

            var ctor = function (dateDepart) {
                this.dateDepart = getDateTime(dateDepart);
            };
            ctor.prototype.getRemainingTime = function() {
                var dateArgs = new Array();
                dateArgs.push(this.dateDepart);
                dateArgs.push(Date.now());
                return dateArgs.reduce(function(prev, courant) { return prev - courant; });
            };

            ctor.prototype.getData = function () {
                var reste = this.getRemainingTime();
                var base = {
                    dateDepart: this.dateDepart
                };
                for (var key in factors) {
                    base[key] = Math.floor(reste / factors[key]);
                    reste -= base[key] * factors[key];
                }
                return base;
            }

            ctor.prototype.toString = function () {
                var base = this.getData();
                var parts = Object.keys(translates).map(function (item) { return base[item] + ' ' + translates[item]; });
                return parts.join(', ');
            };

            return ctor;
        })();

        var TheWritingOnTheWall = (function () {
            var ctor = function (theFinalCountDown) {
                this.theFinalCountDown = theFinalCountDown;
            };

            ctor.prototype.seekAndDestroy = function () {
                document.getElementById('Restant').innerHTML = this.theFinalCountDown.toString();
            };

            ctor.prototype.isRunning = function (elt) {
                return elt.getAttribute('data-stop') === elt.value;
            }

            ctor.prototype.start = function (elt) {
                var that = this;
                this.lastOfTheMohican = setInterval(function() {
                    that.seekAndDestroy();
                }, 1000);
                if (elt)
                    elt.value = elt.getAttribute('data-stop');
            };

            ctor.prototype.stop = function (elt) {
                clearInterval(this.lastOfTheMohican);
                if (elt)
                    elt.value = elt.getAttribute('data-start');
            }
            ctor.prototype.startAndStop = function (elt) {
                if (this.isRunning(elt))
                    this.stop(elt);
                else
                    this.start(elt);
            };

            ctor.prototype.letGetThisStarted = function () {
                debugger;
                var that = this;
                that.start();
                document.getElementById('stopStartCountDown').onclick = function () { that.startAndStop(this) };
            };
            return ctor;
        })();

        var theWritingOnTheWall = new TheWritingOnTheWall(new TheFinalCountDown('2016-04-15 16:00:00 GMT+0200'));
    </script>
</head>
<body>
    <iframe src="//giphy.com/embed/jYAGkoghdmD9S" width="480" height="352" frameborder="0" class="giphy-embed" allowfullscreen></iframe>
    <div>Plus que <span id="Restant"></span></div>
    <input type="button" id="stopStartCountDown" value="arrêter le décompte" data-stop="arrêter le décompte" data-start="reprendre le décompte" />
    <script>
        theWritingOnTheWall.letGetThisStarted();
    </script>
</body>
</html>
